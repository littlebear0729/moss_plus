<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Summary</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
</head>
<body>
<div class="container">
    <table class="table table-striped table-hover" style="margin-top: 20px;">
        <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">File 1</th>
            <th scope="col">File 2</th>
            <th scope="col">Duplicate Rate</th>
            <th scope="col">Operation</th>
        </tr>
        </thead>
        <tbody id="table">
        </tbody>
    </table>
</div>
</body>
<script>
    /*    fetch('summary.json')
            .then(response => response.json())
            .then(jsonResponse => {
                makeTable(jsonResponse)
            })*/

    function makeTable(jsonText) {
        var table = document.getElementById("table")
        for (var i = 0; i < jsonText.length; i++) {
            var row = table.insertRow(i);
            var cellNum = row.insertCell(0);
            var cellFile1 = row.insertCell(1);
            var cellFile2 = row.insertCell(2);
            var cellDupRate = row.insertCell(3);
            var cellOperation = row.insertCell(4);
            cellNum.innerHTML = (i + 1).toString();
            cellFile1.innerHTML = jsonText[i]['FileName1'];
            cellFile2.innerHTML = jsonText[i]['FileName2'];
            cellDupRate.innerHTML = jsonText[i]['DuplicateRate'] + "%";
            const compFilename = jsonText[i]['FileName1'] + "-" + jsonText[i]['FileName2'] + ".html"
            cellOperation.innerHTML = '<a href=\'' + compFilename + '\'>Details</a>'
        }
    }

    const init = async function () {
        let jsonText;
        if (localStorage.getItem("summary")) {
            let localText = localStorage.getItem("summary");
            jsonText = JSON.parse(localText)
            makeTable(jsonText)
        }
        const fileName = await new Promise((resolve) => {
            const input = document.createElement('input');
            input.type = 'file';
            // input.style.display = 'none';
            document.body.appendChild(input);
            input.onchange = () => {
                resolve(input.files[0]);
                // input.remove();
            };
            // input.click();
        });
        const text = await new Promise((resolve, reject) => {
            const fr = new FileReader();
            fr.onload = (x) => resolve(fr.result.toString());
            fr.readAsText(fileName);
        });
        localStorage.setItem("summary", text)
        jsonText = JSON.parse(text)
        console.log(jsonText)
        makeTable(jsonText)
        location.reload()
    }

    init()
</script>
</html>